# PR #47095: agent: Check is_error flag in MCP tool responses

_Merged: 2026-02-12T13:46:46Z_
_PR: https://github.com/zed-industries/zed/pull/47095_

## Documentation Suggestions

### Summary
This change improves error handling in context server tools by properly surfacing error responses to users. When a context server returns an error, agents now receive a meaningful error message instead of potentially confusing content. This affects how users interact with context servers through agents and warrants documentation of the error behavior.

### Suggested Changes

#### 1. docs/src/agents/mcp-servers.md
- **Section**: "Working with Context Servers" or "Troubleshooting" (verify existing sections)
- **Change**: Add
- **Target keyword**: troubleshooting MCP server errors
- **Frontmatter**:
  ```yaml
  ---
  title: Using Model Context Protocol (MCP) Servers with Agents
  description: Learn how to integrate and troubleshoot MCP context servers in Zed's agent workflows.
  ---
  ```
- **Links**: 
  - `/agents` (main agents documentation)
  - `/agents/tools` (agent tools overview)
  - `/settings#context-servers` (if configuration docs exist)
  - `https://zed.dev/blog/mcp` (marketing announcement, if applicable)
- **Suggestion**: 

> **Preview:** This feature is available in Zed Preview. It will be included in the next Stable release.

Add a subsection explaining error handling:

```markdown
### Error Handling

When a context server encounters an error while processing a tool call, the agent receives the error message directly and the operation fails. Common error scenarios include:

- Invalid parameters passed to the tool
- Server-side failures (database connection issues, rate limits)
- Unsupported operations or missing resources

The error message from the context server will be shown in the agent's response, allowing you to diagnose and correct the issue. Check the context server's logs or documentation for details about specific error codes.
```

- **Full-file brand pass**: Required: yes. Without seeing the full file, suggest reviewing for:
  - Any hedging language like "simply" or "just" when describing setup
  - Consistent use of "you" voice and present tense
  - Removal of any marketing-style claims that aren't grounded in specific technical capabilities
  - Ensure settings are shown via Settings Editor UI first, JSON config second

- **Brand voice scorecard**:

  | Criterion            | Score | Notes |
  | -------------------- | ----- | ----- |
  | Technical Grounding  | 4/5   | Specific error types, technical failure modes |
  | Natural Syntax       | 5/5   | Clear, direct sentences |
  | Quiet Confidence     | 5/5   | No hedging, states facts |
  | Developer Respect    | 4/5   | Assumes competence, points to logs/docs |
  | Information Priority | 5/5   | Front-loads error behavior |
  | Specificity          | 4/5   | Concrete examples of error scenarios |
  | Voice Consistency    | 5/5   | Matches second-person, present tense |
  | Earned Claims        | 5/5   | No unearned claims |
  | **TOTAL**            | 37/40 |       |

  Pass threshold: all criteria 4+. âœ“ Passes

### Notes for Reviewer
I've assumed the MCP servers documentation exists based on the code path `context_server_registry.rs`. If the actual documentation structure differs (e.g., if this belongs in a general "Agent Tools" page instead), adjust the file path accordingly. The error handling improvement is user-facing because agents now provide clearer feedback when context server operations fail, which directly affects the debugging experience.
